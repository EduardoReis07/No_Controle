<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">

    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="viewport" content="initial-scale=1, width=device-width, viewport-fit=cover">

    <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Staatliches&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/index.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <title>Tela Principal</title>
</head>

<body>
    <div class="app">

        <!-- Tela Principal -->
        <div id="main" class="page ">
            <div class="header blue">
                <h2>Lista de Compras</h2>
            </div>

            <div id="list"></div>

            <div id="totalGasto"></div>

            <button type="button" class="btn" id="btnForm">
                <svg width="3em" height="3em" viewBox="0 0 16 16" class="bi bi-plus-circle-fill" fill="currentColor"
                    xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd"
                        d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8.5 4.5a.5.5 0 0 0-1 0v3h-3a.5.5 0 0 0 0 1h3v3a.5.5 0 0 0 1 0v-3h3a.5.5 0 0 0 0-1h-3v-3z" />
                </svg>
            </button>

            <button type="button" class="btnDrop" id="drop">
                <svg width="2em" height="2em" viewBox="0 0 16 16" class="bi bi-trash-fill" fill="currentColor"
                    xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd"
                        d="M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1H2.5zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5zM8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7A.5.5 0 0 1 8 5zm3 .5a.5.5 0 0 0-1 0v7a.5.5 0 0 0 1 0v-7z" />
                </svg>
            </button>
        </div>

        <!-- Formulário de Adicionar novos itens na Lista -->
        <div class="form hidden" id="form">
            <div class="header blue">
                <h2>Novo Item</h2>
            </div>

            <input type="text" name="name" id="name" maxlength="11" class="input" placeholder="Insira o nome do Item" />

            <input type="number" name="value" id="value" step="0.01" class="input"
                placeholder="Qual o valor gasto R$" />

            <center>
                <button type="button" id="btnCancel" class="btnForm">Cancelar</button>
                <button type="button" id="btnAdd" class="btnForm">Salvar</button>
            </center>
        </div>

        <!-- Tabs Navigation -->
      <!--   <div class="tab-container">

            <div class="tab blue active" id="Home">
                <svg width="2em" height="2em" viewBox="0 0 16 16" class="bi bi-house" fill="currentColor"
                    xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd"
                        d="M2 13.5V7h1v6.5a.5.5 0 0 0 .5.5h9a.5.5 0 0 0 .5-.5V7h1v6.5a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 13.5zm11-11V6l-2-2V2.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5z" />
                    <path fill-rule="evenodd"
                        d="M7.293 1.5a1 1 0 0 1 1.414 0l6.647 6.646a.5.5 0 0 1-.708.708L8 2.207 1.354 8.854a.5.5 0 1 1-.708-.708L7.293 1.5z" />
                </svg>
                <p>Gastos </p>
            </div>

            <div class="tab pink" id="Graphic">
                <svg width="2em" height="2em" viewBox="0 0 16 16" class="bi bi-pie-chart" fill="currentColor"
                    xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd"
                        d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
                    <path fill-rule="evenodd" d="M7.5 7.793V1h1v6.5H15v1H8.207l-4.853 4.854-.708-.708L7.5 7.793z" />
                </svg>
                <p>Gráficos </p>
            </div>

            <div class="tab green" id="Pay">
                <svg width="2em" height="2em" viewBox="0 0 16 16" class="bi bi-bookmarks" fill="currentColor"
                    xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd"
                        d="M2 4a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v11.5a.5.5 0 0 1-.777.416L7 13.101l-4.223 2.815A.5.5 0 0 1 2 15.5V4zm2-1a1 1 0 0 0-1 1v10.566l3.723-2.482a.5.5 0 0 1 .554 0L11 14.566V4a1 1 0 0 0-1-1H4z" />
                    <path fill-rule="evenodd"
                        d="M4.268 1H12a1 1 0 0 1 1 1v11.768l.223.148A.5.5 0 0 0 14 13.5V2a2 2 0 0 0-2-2H6a2 2 0 0 0-1.732 1z" />
                </svg>
                <p>A Pagar</p>
            </div>

            <div class="tab purple" id="Profit">
                <svg width="2em" height="2em" viewBox="0 0 16 16" class="bi bi-person-plus" fill="currentColor"
                    xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd"
                        d="M8 5a2 2 0 1 1-4 0 2 2 0 0 1 4 0zM6 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm6 5c0 1-1 1-1 1H1s-1 0-1-1 1-4 6-4 6 3 6 4zm-1-.004c-.001-.246-.154-.986-.832-1.664C9.516 10.68 8.289 10 6 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10zM13.5 5a.5.5 0 0 1 .5.5V7h1.5a.5.5 0 0 1 0 1H14v1.5a.5.5 0 0 1-1 0V8h-1.5a.5.5 0 0 1 0-1H13V5.5a.5.5 0 0 1 .5-.5z" />
                </svg>
                <p>Ganho </p>
            </div>

        </div> -->

    </div>
    <script src="cordova.js"></script>
    <script src="js/index.js"></script>
    <script>


        function deleteItem(elem) {

            navigator.notification.confirm(
                'Você realmente quer excluir este item?',
                onConfirm,
                'Tem Certeza?',
                ['Sim', 'Cancelar']
            );

            function onConfirm(buttonIndex) {

                if (buttonIndex == 1) {
                    let $componente = $(elem);
                    let $item = $(elem).parent().text();

                    $componente.parent().remove();

                    var keyItem = $item.split('.........');

                    let sqlite = window.sqlitePlugin.openDatabase({ name: "AppGastos", location: 'default' });

                    sqlite.transaction(transaction => {
                        var sql = "DELETE FROM gastos WHERE name=?";

                        transaction.executeSql(sql, [keyItem[0]],
                            (tx, result) => {

                                navigator.vibrate(500);
                                sumOfValues();

                            },
                            error => {
                                function callbackAlert() {
                                    console.log(error);
                                }

                                navigator.notification.alert(
                                    "Algo deu errado!",
                                    callbackAlert,
                                    "ERRO",
                                    "Ok"
                                );
                            });
                    });
                }
                else {
                    console.log("A operação foi cancelada");
                }
            }
        }

        function sumOfValues() {
            let sqlite = window.sqlitePlugin.openDatabase({ name: "AppGastos", location: 'default' });

            sqlite.transaction(transaction => {
                let sql = "SELECT sum(value) as total FROM gastos;"

                transaction.executeSql(sql, [],
                    (tx, results) => {
                        var tamanho = results.rows.length;

                        for (let i = 0; i < tamanho; i++) {
                            var item = results.rows.item(i);
                            var TotalDatabase = parseFloat(item.total);
                            var TotalConvertido = (TotalDatabase);

                            var ValorTotal = Number.isNaN(TotalConvertido) ? 0 : TotalConvertido.toFixed(2);

                            console.log(ValorTotal);


                            $('#totalGasto').text("Total:  R$" + ValorTotal);
                        }

                    },
                    error => {
                        console.log(error);
                    })
            });
        }
    </script>
</body>

</html>